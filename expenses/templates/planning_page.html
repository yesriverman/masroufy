{% extends 'base.html' %}
{% block title %}๐ ุงูุชุฎุทูุท ุงููุงูู{% endblock %}
{% block content %}

<div class="container mt-3">
    <div class="card shadow-sm ">
      <div class="card-header text-white text-center " >
          <h3 class="text-center mb-2">๐ ุงูุชุฎุทูุท ุงููุงูู ุงูุดูุฑู</h3>
      </div>
      <!-- ๐ Summary Cards (Responsive & Compact) -->
      <div class="row g-2 mt-1">
        <div class="col-12 col-md-4">
          <div class="card text-bg-success h-100">
            <div class="card-body text-center py-1 px-1">
              <h6 class="mb-1">๐ฐ ุงูุฏุฎู ุงููุชููุน</h6>
              <p class="fs-5 mb-0">{{ monthly_income }}</p>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card text-bg-danger h-100">
            <div class="card-body text-center py-1 px-1">
              <h6 class="mb-1">๐ธ ุงููุตุฑููุงุช ุงููุชููุนุฉ</h6>
              <p class="fs-5 mb-0">{{ monthly_expense_total|floatformat:0 }}</p>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="card {% if net_balance >= 0 %}text-bg-primary{% else %}text-bg-warning{% endif %} h-100">
            <div class="card-body text-center py-1 px-2">
              <h6 class="mb-1">๐ ุงูุฑุตูุฏ ุงูุตุงูู</h6>
              <p class="fs-5 mb-0">{{ net_balance|floatformat:0 }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    
      <div class="dropdown mb-2 mt-2">
        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
          โ๏ธ ุฅุนุฏุงุฏุงุช ุงูุชุฎุทูุท
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" href="{% url 'label_add' %}?next={{ request.path }}">โ ุฅุถุงูุฉ ุชุณููุฉ</a></li>
          <li><a class="dropdown-item" href="{% url 'expected_monthly_income_view' %}?next={{ request.path }}">โ๏ธ ุชุนุฏูู ุงูุฏุฎู ุงูุดูุฑู</a></li>
          <li><a class="dropdown-item" href="{% url 'annual_expenses_view' %}?next={{ request.path }}">๐ ุชุนุฏูู ุงููููุงุช ุงูุณูููุฉ</a></li>
          <li><a class="dropdown-item" href="{% url 'monthly_fixed_expenses_view' %}?next={{ request.path }}">๐ ุชุนุฏูู ุงููุตุงุฑูู ุงูุซุงุจุชุฉ</a></li>
        </ul>
      </div>


    <div class="card shadow-sm mb-2">  
      <div class="accordion-item mb-2">
        <h2 class="accordion-header" id="headingAnnual">
          <button class="accordion-button collapsed" type="button"
                  data-bs-toggle="collapse" data-bs-target="#collapseAnnual"
                  aria-expanded="false" aria-controls="collapseAnnual">
            <div class="w-100">
              <div class="d-flex justify-content-between align-items-center flex-wrap">
                <span>๐ ุงููููุงุช ุงูุณูููุฉ</span>
              </div>
              <div class="d-flex justify-content-start flex-wrap mt-2 gap-2">
                <span class="badge bg-light text-dark">
                  ุงูุฅุฌูุงูู ุงูุณููู: <span class="fw-bold">{{ annual_total }}</span>
                </span>
                <span class="badge bg-light text-dark">
                  ููุณู ุดูุฑูุงู: <span class="fw-bold">{{ annual_monthly_equiv|floatformat:0 }}</span>
                </span>
              </div>
            </div>
          </button>
        </h2>
      </div>
       
    
      <div id="collapseAnnual" class="accordion-collapse collapse " aria-labelledby="headingAnnual" data-bs-parent="#groupAccordion">
        <div class="accordion-body">
          {% if annual_labels %}
            <div class="accordion" id="annualLabelAccordion">
              {% for label in annual_labels %}
                <div class="accordion-item mb-2">
                  <h2 class="accordion-header" id="annualLabelHeading{{ label.id }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#annualLabelCollapse{{ label.id }}" aria-expanded="false"
                            aria-controls="annualLabelCollapse{{ label.id }}">
                      ๐ท๏ธ {{ label.name }}
                    </button>
                  </h2>
                  <div id="annualLabelCollapse{{ label.id }}" class="accordion-collapse collapse"
                      aria-labelledby="annualLabelHeading{{ label.id }}" data-bs-parent="#annualLabelAccordion">
                    <div class="accordion-body">
                      <!-- ๐ป Desktop View: Table -->
                      <div class="table-responsive d-none d-md-block">
                        <table class="table table-bordered text-center align-middle">
                          <thead class="table-warning">
                            <tr>
                              <th>๐ฐ ุงููุจูุบ ุงูุณููู</th>
                              <th>ุงูุฅุฌุฑุงุกุงุช</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>{{ label.expected_monthly }}</td>
                              <td>
                                <a href="{% url 'label_edit' label.id %}?next={{ request.path }}" class="btn btn-sm btn-warning">โ๏ธ</a>
                                <a href="{% url 'label_delete' label.id %}?next={{ request.path }}" class="btn btn-sm btn-danger">๐๏ธ</a>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <!-- ๐ฑ Mobile View: Card -->
                      <div class="d-block d-md-none">
                        <div class="card border-warning mb-2">
                          <div class="card-body">
                            <p><strong>๐ฐ ุงููุจูุบ ุงูุณููู:</strong> {{ label.expected_monthly }}</p>
                            <div class="d-flex gap-2 justify-content-end">
                              <a href="{% url 'label_edit' label.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-warning">โ๏ธ ุชุนุฏูู</a>
                              <a href="{% url 'label_delete' label.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-danger">๐๏ธ ุญุฐู</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-muted">ูุง ุชูุฌุฏ ุชุณููุงุช ุณูููุฉ</p>
          {% endif %}
          <!-- โ Add Button -->
          <div class="d-flex justify-content-between mt-3">
            <a href="{% url 'label_add' %}?group=annual&next={{ request.path }}" class="btn btn-sm btn-primary">โ ุฅุถุงูุฉ ุชุณููุฉ ุณูููุฉ</a>
            <a href="{% url 'annual_expenses_view' %}?next={{ request.path }}" class="btn btn-sm btn-outline-secondary">โ๏ธ ุชุนุฏูู ุงููููุงุช ุงูุณูููุฉ</a>
          </div>
        </div>
      </div>
    </div>


    <!-- ๐ Regular Groups -->
    {% for group in groups %}
      <div class="accordion-item mb-2">
        <h2 class="accordion-header" id="heading{{ group.id }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapse{{ group.id }}" aria-expanded="false" aria-controls="collapse{{ group.id }}">
            ๐๏ธ {{ group.name }}
            <span class="badge bg-light text-dark ms-2">
              ุงููุฌููุน: <span class="fw-bold fs-5">{{ group.total_expected|floatformat:0 }}</span>
            </span>
          </button>
        </h2>
        <div id="collapse{{ group.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ group.id }}" data-bs-parent="#groupAccordion">
          <div class="accordion-body">

            {% if group.labels.all %}
              <div class="accordion" id="labelAccordion{{ group.id }}">
                {% for label in group.labels.all %}
                  <div class="accordion-item mb-2">
                    <h2 class="accordion-header" id="labelHeading{{ label.id }}">
                      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                              data-bs-target="#labelCollapse{{ label.id }}" aria-expanded="false"
                              aria-controls="labelCollapse{{ label.id }}">
                        ๐ท๏ธ {{ label.name }}
                      </button>
                    </h2>
                    <div id="labelCollapse{{ label.id }}" class="accordion-collapse collapse"
                        aria-labelledby="labelHeading{{ label.id }}" data-bs-parent="#labelAccordion{{ group.id }}">
                      <div class="accordion-body">
                        <!-- ๐ป Desktop View: Table -->
                        <div class="table-responsive d-none d-md-block">
                          <table class="table table-bordered text-center align-middle">
                            <thead class="table-light">
                              <tr>
                                <th>๐ฐ ุงููุจูุบ ุงููุชููุน</th>
                                <th>ุงูุฅุฌุฑุงุกุงุช</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>{{ label.expected_monthly }}</td>
                                <td>
                                  <a href="{% url 'label_edit' label.id %}?next={{ request.path }}" class="btn btn-sm btn-warning">โ๏ธ</a>
                                  <a href="{% url 'label_delete' label.id %}?next={{ request.path }}" class="btn btn-sm btn-danger">๐๏ธ</a>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <!-- ๐ฑ Mobile View: Card -->
                        <div class="d-block d-md-none">
                          <div class="card border-light mb-2">
                            <div class="card-body">
                              <p><strong>๐ฐ ุงููุจูุบ ุงููุชููุน:</strong> {{ label.expected_monthly }}</p>
                              <div class="d-flex gap-2 justify-content-end">
                                <a href="{% url 'label_edit' label.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-warning">โ๏ธ ุชุนุฏูู</a>
                                <a href="{% url 'label_delete' label.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-danger">๐๏ธ ุญุฐู</a>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <p class="text-muted">ูุง ุชูุฌุฏ ุชุณููุงุช ูู ูุฐู ุงููุฌููุนุฉ</p>
            {% endif %}

            <!-- โ Group Controls -->
            <div class="d-flex justify-content-between mt-3">
              <a href="{% url 'label_add' %}?group={{ group.id }}&next={{ request.path }}" class="btn btn-sm btn-primary">โ ุฅุถุงูุฉ ุชุณููุฉ</a>
              <div class="d-flex gap-2">
                <a href="{% url 'group_edit' group.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-warning">โ๏ธ ุชุนุฏูู ุงููุฌููุนุฉ</a>
                <a href="{% url 'group_delete' group.id %}?next={{ request.path }}" class="btn btn-sm btn-outline-danger">๐๏ธ ุญุฐู ุงููุฌููุนุฉ</a>
              </div>
            </div>

          </div>
        </div>
      </div>
    {% endfor %}
  </div>
<!-- JS for Expand/Collapse -->
<script>
  function expandAll() {
    document.querySelectorAll('.accordion-collapse').forEach(el => {
      const collapse = new bootstrap.Collapse(el, { toggle: false });
      collapse.show();
    });
  }

  function collapseAll() {
    document.querySelectorAll('.accordion-collapse').forEach(el => {
      const collapse = new bootstrap.Collapse(el, { toggle: false });
      collapse.hide();
    });
  }
</script>


{% endblock %}

