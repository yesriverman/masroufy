{% extends 'base.html' %}
{% block title %}ğŸ“Š Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª{% endblock %}
{% block content %}


<div class="container mt-2">
  <div class="card shadow-sm rounded-1">
      <div class="card-header text-white text-center " >
          <h3 class="text-center mb-2">ğŸ“Š Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©</h3>
      </div>
  
<!-- ğŸ” Responsive Filter Form -->
<form method="get" class="row g-2 g-md-3 mb-2 mt-1 px-2 align-items-end">

  <!-- ğŸ“… Start Date -->
  <div class="col-6 col-md-2 d-flex flex-column flex-md-column">
    <label for="start_date" class="form-label mb-1">ğŸ“… Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
    <input type="date" name="start_date" id="start_date" value="{{ start_date }}" class="form-control">
  </div>

  <!-- ğŸ“… End Date -->
  <div class="col-6 col-md-2 d-flex flex-column flex-md-column">
    <label for="end_date" class="form-label mb-1">ğŸ“… Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
    <input type="date" name="end_date" id="end_date" value="{{ end_date }}" class="form-control">
  </div>

  <!-- ğŸ—‚ï¸ Group -->
  <div class="col-6 col-md-2 d-flex flex-column flex-md-column">
    <label for="group" class="form-label mb-1">ğŸ—‚ï¸ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label>
    <select name="group" id="group" class="form-select">
      <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
      {% for group in groups %}
        <option value="{{ group.id }}" {% if group.id == selected_group %}selected{% endif %}>{{ group.name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- ğŸ·ï¸ Label -->
  <div class="col-6 col-md-2 d-flex flex-column flex-md-column">
    <label for="label" class="form-label mb-1">ğŸ·ï¸ Ø§Ù„ØªØ³Ù…ÙŠØ© Ø§Ù„ÙØ±Ø¹ÙŠØ©</label>
    <select name="label" id="label" class="form-select">
      <option value="">-- Ø§Ù„ÙƒÙ„ --</option>
      {% for label in labels %}
        <option value="{{ label.id }}" {% if label.id == selected_label %}selected{% endif %}>{{ label.name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- ğŸ“Š Submit + ğŸ”„ Reset Buttons -->
  <div class="col-12 col-md-4 d-flex gap-2">
    <button type="submit" class="btn btn-primary w-100">ğŸ“Š Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
    <a href="{% url 'home' %}" class="btn btn-outline-secondary w-100">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</a>
  </div>

</form> 



<!-- ğŸ“Š Summary Cards -->
<div class="row g-2 mt-2">
  <!-- ğŸ’° Total Income -->
  <div class="col-12 col-sm-6 col-md-4">
    <div class="card text-bg-success h-100">
      <div class="card-body text-center py-3 px-2">
        <h6 class="mb-1">ğŸ’° Ø§Ù„Ø¯Ø®Ù„</h6>
        <p class="fw-bold fs-5 mb-0">{{ total_income|floatformat:0 }} Ø¯.Ù…</p>
      </div>
    </div>
  </div>

  <!-- ğŸ’¸ Total Expense -->
  <div class="col-12 col-sm-6 col-md-4">
    <div class="card text-bg-danger h-100">
      <div class="card-body text-center py-3 px-2">
        <h6 class="mb-1">ğŸ’¸ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h6>
        <p class="fw-bold fs-5 mb-0">{{ total_expense|floatformat:0 }} Ø¯.Ù…</p>
      </div>
    </div>
  </div>

  <!-- ğŸ“ˆ Net Balance -->
  <div class="col-12 col-sm-6 col-md-4">
    <div class="card {% if balance >= 0 %}text-bg-primary{% else %}text-bg-warning{% endif %} h-100">
      <div class="card-body text-center py-3 px-2">
        <h6 class="mb-1">ğŸ“ˆ Ø§Ù„Ø±ØµÙŠØ¯</h6>
        <p class="fw-bold fs-5 mb-0">{{ balance|floatformat:0 }} Ø¯.Ù…</p>
      </div>
    </div>
  </div>
</div>
</div>

  <!-- Add Expense Button -->
  <div class="mb-2 text-end mt-2">
    <a href="{% url 'expense_add' %}?next={{ request.path }}" class="btn btn-success">â• Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</a>
    <a href="{% url 'add_expense_view' %}?next={{ request.path }}" class="btn btn-success">â•  Ø¥Ø¶Ø§ÙØ© Ù…ØµØ§Ø±ÙŠÙ Ù…ØªØ¹Ø¯Ø¯Ø©</a>        
  </div>
<!-- Grouped Expenses Accordion -->
{% if grouped_expenses %}
  <div class="accordion" id="expenseAccordion">
    {% for label_obj, data in grouped_expenses.items %}

    {% comment %} {% for label, data in grouped_expenses.items %} {% endcomment %}
      <div class="accordion-item mb-2">
        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
          <button class="accordion-button collapsed px-3 py-2" type="button"
                  data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}"
                  aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">

            <div class="d-flex w-100 text-center">
              <div class="flex-grow-2 border-end pe-2" style="flex: 2;">
                <span class="fw-bold">ğŸ·ï¸ {{ label_obj.name }}</span>
              </div>
              <div class="flex-grow-1 border-end px-2" style="flex: 1;">
                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: <strong>{{ data.total|floatformat:0 }}</strong></span>
              </div>
              <div class="flex-grow-1 ps-2" style="flex: 1;">
                <span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: <strong>{{ label_obj.expected_monthly }} Ø¯.Ù…</strong></span>

                {% comment %} <span>Ø§Ù„Ø¹Ø¯Ø¯: <strong>{{ data.items|length }}</strong></span> {% endcomment %}
              </div>
            </div>


          </button>
        </h2>

        <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse"
             aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#expenseAccordion">
          <div class="accordion-body">
            <ul class="list-group">
              {% for expense in data.items %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ expense.amount|floatformat:0 }}
                  <span class="badge bg-secondary">{{ expense.date|date:"D-d-m-Y" }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-muted mt-4 text-center">
    Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø²Ù…Ù†ÙŠ Ø£Ùˆ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©.
  </p>
{% endif %}

</div>

{% endblock %}
