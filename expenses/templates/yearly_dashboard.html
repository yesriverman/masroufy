{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-header text-white " >
      <div class="row align-items-center">
        <div class="col-md-9 ">
          <h3 class="mb-0">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© {{ year }}</h3>
        </div>
        <div class="col-md-3 text-end">

          <form method="get" class="d-flex flex-wrap gap-2 align-items-center">
            <div class="flex-grow-1">
              <select name="year" class="form-select form-select-sm tom-select" style="font-size: 0.85rem;">
                {% for y in year_range %}
                  <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
              </select>
            </div>
            <button type="submit" class="btn btn-primary btn-sm">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
          </form>
{% comment %} 
<div class="card mb-4">
  <div class="card-header text-center fw-bold">ğŸ“Š ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</div>
  <div class="card-body">
    <canvas id="donutChart" height="300"></canvas>

    <script>
    const donutCtx = document.getElementById('donutChart').getContext('2d');
    new Chart(donutCtx, {
      type: 'doughnut',
      data: {
        labels: {{ donut_labels|safe }},
        datasets: [{
          data: {{ donut_values|safe }},
          backgroundColor: [
            '#f44336', '#2196f3', '#4caf50', '#ff9800', '#9c27b0',
            '#00bcd4', '#8bc34a', '#e91e63', '#3f51b5', '#ff5722'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              font: { size: 12 }
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                return `${context.label}: ${context.parsed} Ø¯.Ù…`;
              }
            }
          }
        }
      }
    });
    </script>


<canvas id="pieChart"></canvas>
<script>
const pieCtx = document.getElementById('pieChart').getContext('2d');
new Chart(pieCtx, {
  type: 'pie',
  data: {
    labels: {{ pie_labels|safe }},
    datasets: [{
      data: {{ pie_values|safe }},
      backgroundColor: ['#f44336', '#2196f3', '#4caf50', '#ff9800', '#9c27b0']
    }]
  }
});
</script>

<canvas id="lineChart"></canvas>
<script>
const lineCtx = document.getElementById('lineChart').getContext('2d');
new Chart(lineCtx, {
  type: 'line',
  data: {
    labels: {{ line_months|safe }},
    datasets: [
      {
        label: 'Ø§Ù„Ø¯Ø®Ù„',
        data: {{ line_income|safe }},
        borderColor: '#4caf50',
        fill: false
      },
      {
        label: 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ',
        data: {{ line_expense|safe }},
        borderColor: '#f44336',
        fill: false
      }
    ]
  }
});
</script>

<canvas id="barChart"></canvas>
<script>
const barCtx = document.getElementById('barChart').getContext('2d');
new Chart(barCtx, {
  type: 'bar',
  data: {
    labels: {{ bar_labels|safe }},
    datasets: [
      {
        label: 'Ø§Ù„ÙØ¹Ù„ÙŠ',
        data: {{ bar_actual|safe }},
        backgroundColor: '#2196f3'
      },
      {
        label: 'Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
        data: {{ bar_expected|safe }},
        backgroundColor: '#9c27b0'
      }
    ]
  }
});
</script>

<canvas id="heatmapChart"></canvas>
<script>
const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
new Chart(heatmapCtx, {
  type: 'bar',
  data: {
    labels: {{ heatmap_months|safe }},
    datasets: [{
      label: 'Ø´Ø¯Ø© Ø§Ù„Ø¥Ù†ÙØ§Ù‚',
      data: {{ heatmap_intensity|safe }},
      backgroundColor: '#ff9800'
    }]
  }
});
</script>
 {% endcomment %}


  </div>
</div>
  </div>
</div>



<div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3 mt-3">
  {% comment %} <!-- Donut Chart Card -->
  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
      <div class="card-body">
        <canvas id="donutChart" height="250"></canvas>
        <script>
        const donutCtx = document.getElementById('donutChart').getContext('2d');
        new Chart(donutCtx, {
          type: 'doughnut',
          data: {
            labels: {{ donut_labels|safe }},
            datasets: [{
              data: {{ donut_values|safe }},
              backgroundColor: [
                '#f44336', '#2196f3', '#4caf50', '#ff9800', '#9c27b0',
                '#00bcd4', '#8bc34a', '#e91e63', '#3f51b5', '#ff5722'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  font: { size: 12 }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.parsed} Ø¯.Ù…`;
                  }
                }
              }
            }
          }
        });
        </script>
      </div>
    </div>
  </div> {% endcomment %}

  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</div>
      <div class="card-body">
        <canvas id="groupDonutChart" height="250"></canvas>
        <script>
        const groupDonutCtx = document.getElementById('groupDonutChart').getContext('2d');
        new Chart(groupDonutCtx, {
          type: 'doughnut',
          data: {
            labels: {{ group_labels|safe }},
            datasets: [{
              data: {{ group_values|safe }},
              backgroundColor: [
                '#4caf50', '#f44336', '#2196f3', '#ff9800', '#9c27b0',
                '#00bcd4', '#8bc34a', '#e91e63', '#3f51b5', '#ff5722'
              ],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  font: { size: 12 }
                }
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.label}: ${context.parsed} Ø¯.Ù…`;
                  }
                }
              }
            }
          }
        });
        </script>
      </div>
    </div>
  </div>



  <!-- Pie Chart Card -->
  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ¥§ Ø£Ù‡Ù… Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¥Ù†ÙØ§Ù‚Ø§Ù‹</div>
      <div class="card-body">
        <canvas id="pieChart" height="250"></canvas>
        <script>
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        new Chart(pieCtx, {
          type: 'pie',
          data: {
            labels: {{ pie_labels|safe }},
            datasets: [{
              data: {{ pie_values|safe }},
              backgroundColor: ['#f44336', '#2196f3', '#4caf50', '#ff9800', '#9c27b0']
            }]
          }
        });
        </script>
      </div>
    </div>
  </div>

  <!-- Line Chart Card -->
  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ“ˆ Ø§Ù„Ø¯Ø®Ù„ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ Ø´Ù‡Ø±ÙŠØ§Ù‹</div>
      <div class="card-body">
        <canvas id="lineChart" height="250"></canvas>
        <script>
        const lineCtx = document.getElementById('lineChart').getContext('2d');
        new Chart(lineCtx, {
          type: 'line',
          data: {
            labels: {{ line_months|safe }},
            datasets: [
              {
                label: 'Ø§Ù„Ø¯Ø®Ù„',
                data: {{ line_income|safe }},
                borderColor: '#4caf50',
                fill: false
              },
              {
                label: 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ',
                data: {{ line_expense|safe }},
                borderColor: '#f44336',
                fill: false
              }
            ]
          }
        });
        </script>
      </div>
    </div>
  </div>

  <!-- Bar Chart Card -->
  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ“Š Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ</div>
      <div class="card-body">
        <canvas id="barChart" height="250"></canvas>
        <script>
        const barCtx = document.getElementById('barChart').getContext('2d');
        new Chart(barCtx, {
          type: 'bar',
          data: {
            labels: {{ bar_labels|safe }},
            datasets: [
              {
                label: 'Ø§Ù„ÙØ¹Ù„ÙŠ',
                data: {{ bar_actual|safe }},
                backgroundColor: '#2196f3'
              },
              {
                label: 'Ø§Ù„Ù…ØªÙˆÙ‚Ø¹',
                data: {{ bar_expected|safe }},
                backgroundColor: '#9c27b0'
              }
            ]
          }
        });
        </script>
      </div>
    </div>
  </div>

  <!-- Heatmap Chart Card -->
  <div class="col">
    <div class="card h-100 shadow-sm">
      <div class="card-header text-center fw-bold">ğŸ”¥ Ø´Ø¯Ø© Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±</div>
      <div class="card-body">
        <canvas id="heatmapChart" height="250"></canvas>
          <script>
          const heatmapCtx = document.getElementById('heatmapChart').getContext('2d');
          new Chart(heatmapCtx, {
            type: 'bar',
            data: {
              labels: {{ heatmap_months|safe }},
              datasets: [{
                label: 'Ø´Ø¯Ø© Ø§Ù„Ø¥Ù†ÙØ§Ù‚',
                data: {{ heatmap_intensity|safe }},
                backgroundColor: '#ff9800'
              }]
            }
          });
          </script>
      </div>
    </div>
  </div>

<div class="col">
  <div class="card h-100 shadow-sm">
    <div class="card-header text-center fw-bold">ğŸ’° Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ù…Ù† Ø§Ù„ØªØµÙ†ÙŠÙ)</div>
    <div class="card-body">
      <canvas id="savingsChart" height="250"></canvas>
      <script>
      const savingsCtx = document.getElementById('savingsChart').getContext('2d');
      new Chart(savingsCtx, {
        type: 'line',
        data: {
          labels: {{ savings_labels|safe }},
          datasets: [{
            label: 'Ø§Ù„Ø§Ø¯Ø®Ø§Ø±',
            data: {{ savings_values|safe }},
            borderColor: '#4caf50',
            backgroundColor: 'rgba(76, 175, 80, 0.2)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Ø§Ø¯Ø®Ø§Ø±: ${context.parsed} Ø¯.Ù…`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return value + ' Ø¯.Ù…';
                }
              }
            }
          }
        }
      });
      </script>

    </div>
  </div>
</div>


</div>


<!-- ğŸ“… Monthly Summary Accordion -->
<div class="accordion mb-4 mt-4" id="monthlySummaryAccordion">
  <div class="accordion-item">
    <h2 class="accordion-header" id="monthlySummaryHeading">
      <button class="accordion-button collapsed fw-bold bg-light" type="button"
              data-bs-toggle="collapse" data-bs-target="#monthlySummaryCollapse"
              aria-expanded="false" aria-controls="monthlySummaryCollapse">
        ğŸ“… ØªÙØµÙŠÙ„ Ø´Ù‡Ø±ÙŠ
      </button>
    </h2>
    <div id="monthlySummaryCollapse" class="accordion-collapse collapse"
         aria-labelledby="monthlySummaryHeading" data-bs-parent="#monthlySummaryAccordion">
      <div class="accordion-body p-0">
        <div class="table-responsive" dir="rtl">
          <table class="table table-bordered text-center align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Ø§Ù„Ø´Ù‡Ø±</th>
                <th>Ø§Ù„Ø¯Ø®Ù„</th>
                <th>Ø§Ù„Ø«Ø§Ø¨ØªØ©</th>
                <th>Ø§Ù„Ù…ØªØºÙŠØ±Ø©</th>
                <th>Ø§Ù„Ù‚Ø³Ø· Ø§Ù„Ø³Ù†ÙˆÙŠ</th>
                <th>Ø§Ù„Ø±ØµÙŠØ¯</th>
              </tr>
            </thead>
            <tbody>
              {% for month in monthly_data %}
              <tr>
                <td>{{ month.name }}</td>
                <td>{{ month.income }}</td>
                <td>{{ month.fixed }}</td>
                <td>{{ month.variable }}</td>
                <td>{{ month.installment }}</td>
                <td class="{% if month.balance < 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ month.balance }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

 <!-- ğŸ·ï¸ Category Comparison Accordion -->
<div class="accordion mb-4" id="categoryComparisonAccordion">
  <div class="accordion-item">
    <h2 class="accordion-header" id="categoryComparisonHeading">
      <button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#categoryComparisonCollapse" aria-expanded="false" aria-controls="categoryComparisonCollapse">
        ğŸ·ï¸ Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
      </button>
    </h2>
    <div id="categoryComparisonCollapse" class="accordion-collapse collapse" aria-labelledby="categoryComparisonHeading" data-bs-parent="#categoryComparisonAccordion">
      <div class="accordion-body p-0">
        <div class="table-responsive" dir="rtl">
          <table class="table mb-0">
            <thead class="table-light">
              <tr>
                <th>Ø§Ù„ØªØ³Ù…ÙŠØ©</th>
                <th>Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ Ø§Ù„Ø³Ù†ÙˆÙŠ</th>
                <th>Ø§Ù„ÙØ¹Ù„ÙŠ</th>
                <th>Ø§Ù„ÙØ±Ù‚</th>
              </tr>
            </thead>
            <tbody>
              {% for label, totals in category_totals.items %}
              <tr>
                <td>{{ label }}</td>
                <td>{{ totals.expected }}</td>
                <td>{{ totals.actual }}</td>
                <td class="{% if totals.diff > 0 %}text-danger{% else %}text-success{% endif %}">
                  {{ totals.diff|floatformat:0 }}
                </td>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>


  <!-- ğŸ”¹ Smart Insights -->
  {% if insights %}
  <div class="mb-4">
    <h5>ğŸ§  Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø°ÙƒÙŠØ©</h5>
    {% for insight in insights %}
      <div class="alert alert-info">{{ insight }}</div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- ğŸ”¹ Budget Simulator (Optional) -->


</div>
{% endblock %}



{% comment %} 

- Total Income vs. Total Expenses
- full-year totals side by side with balance and percentage spent
- Monthly Average	Display average monthly income and expenses, with trend arrows (ğŸ“ˆğŸ“‰).
- Savings Rate	Calculate savings as a percentage of income
- - Top Spending Categories	Pie chart
- ranked list of labels with highest totals.
- Budget vs. Actual	Compare expected_monthly Ã— 12 vs. actual totals per label. Highlight overspending.
- Monthly Breakdown Grid
- A 12-column layout showing each monthâ€™s:Income, Fixed expenses, Variable expenses, Annual installment, Net balance     
- make this collapsible or scrollable, with color-coded cells (green for surplus, red for deficit).

    ğŸ§  Smart Insights Section
- Let the dashboard feel intelligent:
      â€œYou spent 22% more on groceries than planned.â€
      â€œYour lowest spending month was February.â€
      â€œYou saved 18,000 Ø¯.Ù… more than last year.â€
      These can be generated from your data model and shown as cards or alerts.

      ğŸ“ˆ Visuals That Matter
- - Line chart: Monthly income vs. expenses
- - Bar chart: Category-wise spending
- - Donut chart: Expense distribution
- - Heatmap: Spending intensity by month
      Use Chart.js or Plotly for interactive visuals.
      ğŸ§® Budget Planner Panel
- Let users simulate changes:
      â€œIf I increase rent by 500 Ø¯.Ù…, how does my yearly balance change?â€
      â€œWhat if I cut entertainment by 30%?â€
      This could be a form with sliders and instant recalculations.
      ğŸ§­ Navigation & UX Suggestions
- Replace accordion-heavy layout with cards and tabs
- Add summary badges at the top (e.g. ğŸ’° Total Saved: 24,000 Ø¯.Ù…)
- Summary Cards (Income, Expenses, Balance)
- Charts (Income vs. Expenses, Category Split)
- Monthly Breakdown Table (Janâ€“Dec) 
- Smart Insights (overspending, savings rate)
- Budget Simulator (sliders + recalculations)


{% endcomment %}

